<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bouncibility: C:/Users/chase/Desktop/game2/edge/bouncibility/src/EntityManager.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>C:/Users/chase/Desktop/game2/edge/bouncibility/src/EntityManager.cpp</h1><a href="_entity_manager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="_common_8h.html">Common.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include "irrXML.h"</span>     
<a name="l00003"></a>00003 <span class="preprocessor">#include "irrlicht.h"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "<a class="code" href="_entity_manager_8h.html">.\EntityManager.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include "<a class="code" href="_level_manager_8h.html">LevelManager.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "irrnewt.hpp"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="ball_8h.html">ball.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="_world_entity_8h.html">WorldEntity.h</a>"</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">using namespace </span>irr;
<a name="l00011"></a>00011 <span class="keyword">using namespace </span>io;
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="class_entity_1_1_ball_factory.html#3ae57e75300371d7eab884a10d0028b3">00014</a> <a class="code" href="class_world_entity.html">WorldEntity</a>&amp; <a class="code" href="class_entity_1_1_ball_factory.html#3ae57e75300371d7eab884a10d0028b3" title="Each child class of EntityFactory should implement the way it wishes to load its...">Entity::BallFactory::loadEntity</a>(<span class="keyword">const</span> std::string&amp; XMLFilename){
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         std::cout &lt;&lt; <span class="stringliteral">"in ball factory opening xml file "</span> &lt;&lt; XMLFilename &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018         irr::io::IrrXMLReader* xml = irr::io::createIrrXMLReader(XMLFilename.c_str());
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="comment">// strings for storing the data we want to get out of the file</span>
<a name="l00021"></a>00021         std::string name;
<a name="l00022"></a>00022         std::string meshFile;
<a name="l00023"></a>00023         std::string textureFile;
<a name="l00024"></a>00024         std::string startState;
<a name="l00025"></a>00025         <span class="keywordflow">while</span>(xml &amp;&amp; xml-&gt;read())
<a name="l00026"></a>00026         {
<a name="l00027"></a>00027                 <span class="keywordflow">switch</span>(xml-&gt;getNodeType())
<a name="l00028"></a>00028                 {
<a name="l00029"></a>00029                 <span class="keywordflow">case</span> EXN_TEXT:
<a name="l00030"></a>00030                         <span class="comment">//No text nodes</span>
<a name="l00031"></a>00031                         <span class="keywordflow">break</span>;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033                 <span class="keywordflow">case</span> EXN_ELEMENT:
<a name="l00034"></a>00034                         <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">"ball"</span>, xml-&gt;getNodeName())){
<a name="l00035"></a>00035                                 name = xml-&gt;getAttributeValue(<span class="stringliteral">"name"</span>);
<a name="l00036"></a>00036                                 meshFile = xml-&gt;getAttributeValue(<span class="stringliteral">"mesh"</span>);
<a name="l00037"></a>00037                                 textureFile = xml-&gt;getAttributeValue(<span class="stringliteral">"texture"</span>);
<a name="l00038"></a>00038                                 startState = xml-&gt;getAttributeValue(<span class="stringliteral">"start_state"</span>);
<a name="l00039"></a>00039                         }
<a name="l00040"></a>00040                         <span class="keywordflow">break</span>;
<a name="l00041"></a>00041                 }
<a name="l00042"></a>00042         }
<a name="l00043"></a>00043         irr::scene::ISceneManager* <a class="code" href="main_8cpp.html#b6ec4f526efa0e3dd8d15608b44c7afc">smgr</a> = <a class="code" href="class_level_manager.html#175e1bac6656b82c7ea680d304b4bd1e">LevelManager::getSceneManager</a>();
<a name="l00044"></a>00044         <span class="comment">//irr::scene::IAnimatedMesh* mesh = smgr-&gt;getMesh(meshFile.c_str());    </span>
<a name="l00045"></a>00045         <span class="comment">//irr::scene::IAnimatedMeshSceneNode* node = smgr-&gt;addAnimatedMeshSceneNode( mesh );</span>
<a name="l00046"></a>00046         irr::scene::ISceneNode* node = smgr-&gt;addSphereSceneNode(22);
<a name="l00047"></a>00047         <span class="keywordflow">if</span> (node)
<a name="l00048"></a>00048         {
<a name="l00049"></a>00049                 node-&gt;setScale(core::vector3df(1.0f,1.0f,1.0f));
<a name="l00050"></a>00050                 node-&gt;setMaterialFlag(irr::video::EMF_LIGHTING, <span class="keyword">false</span>);
<a name="l00051"></a>00051                 <span class="comment">//node-&gt;setMD2Animation ( irr::scene::EMAT_STAND );</span>
<a name="l00052"></a>00052                 <span class="comment">//node-&gt;setMaterialTexture( 0, LevelManager::getDriver()-&gt;getTexture(textureFile.c_str()) );</span>
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054         node-&gt;setPosition(core::vector3df(-150,50,0));
<a name="l00055"></a>00055 
<a name="l00056"></a>00056         <a class="code" href="class_world_entity.html">WorldEntity</a>* entity = <span class="keyword">new</span> <a class="code" href="class_ball.html">Ball</a>();
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         <span class="comment">//create physics for ball</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         entity-&gt;<a class="code" href="class_world_entity.html#4a4b4bae7a3c076a4fd292c00b7e9181">setMesh</a>(NULL);
<a name="l00062"></a>00062         irr::newton::IMaterial* <a class="code" href="_physics_manager_8h.html#8053f45f40a77e22d877d330cc46242c">material</a> = <a class="code" href="class_level_manager.html#17b4aa3090014cdcff8077e9c0ff5582">LevelManager::getPhysicsWorld</a>()-&gt;createMaterial();
<a name="l00063"></a>00063         entity-&gt;<a class="code" href="class_world_entity.html#9f7ec0ff1cddd5379c179711a08d1035">setBodyMaterial</a>(material);
<a name="l00064"></a>00064         irr::newton::SBodyFromNode physics_node;
<a name="l00065"></a>00065         physics_node.Node = node;
<a name="l00066"></a>00066         physics_node.Type = irr::newton::EBT_PRIMITIVE_ELLIPSOID;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         irr::newton::ICharacterController* body = <a class="code" href="class_level_manager.html#17b4aa3090014cdcff8077e9c0ff5582">LevelManager::getPhysicsWorld</a>()-&gt;createCharacterController(<a class="code" href="class_level_manager.html#17b4aa3090014cdcff8077e9c0ff5582">LevelManager::getPhysicsWorld</a>()-&gt;createBody(physics_node));
<a name="l00069"></a>00069         body-&gt;setRotationUpdate(<span class="keyword">true</span>);
<a name="l00070"></a>00070         body-&gt;setContinuousCollisionMode(<span class="keyword">true</span>);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         body-&gt;setMaterial(material);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         
<a name="l00075"></a>00075         body-&gt;addForceContinuous(irr::core::vector3df(0,-2.0f,0));
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         entity-&gt;<a class="code" href="class_world_entity.html#2aab9745b008723ab12196fee78d4cac">setPhysicsBody</a>(body);
<a name="l00078"></a>00078         entity-&gt;<a class="code" href="class_world_entity.html#2c8d8481524d9dd4df94dda1b990715e">setSceneNode</a>(node);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <span class="comment">//entity-&gt;changeState(startState)</span>
<a name="l00081"></a>00081         <span class="keywordflow">return</span> *entity;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="class_entity_1_1_entity_factory.html#0354d2f6d0cdff783b50b97f2b65d048">00084</a> <a class="code" href="class_entity_1_1_entity_factory.html#0354d2f6d0cdff783b50b97f2b65d048">Entity::EntityFactory::EntityFactory</a>(){
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="class_entity_1_1_entity_factory.html#a5ad4e79b520cf4d0496c48e4058e5c3">00087</a> <a class="code" href="class_entity_1_1_entity_factory.html#a5ad4e79b520cf4d0496c48e4058e5c3">Entity::EntityFactory::~EntityFactory</a>(){
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="class_entity_1_1_loader.html#674fca3172980a597b7afad7048c1c5f">00090</a> <a class="code" href="class_entity_1_1_loader.html#674fca3172980a597b7afad7048c1c5f">Entity::Loader::Loader</a>(){
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="class_entity_1_1_loader.html#97c7ab8fa72a8688f2743aa67791b02f">00093</a> <a class="code" href="class_entity_1_1_loader.html#97c7ab8fa72a8688f2743aa67791b02f">Entity::Loader::~Loader</a>(){
<a name="l00094"></a>00094         <a class="code" href="class_entity_1_1_loader.html#b9756a289d5344fa846ee57a14f6cd2a" title="Removes all registered factories and frees up their memory.">removeAll</a>();
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096         
<a name="l00097"></a><a class="code" href="class_entity_1_1_loader.html#0cf9b837e94d970e13f4fad650bef4ef">00097</a> <span class="keywordtype">bool</span> <a class="code" href="class_entity_1_1_loader.html#0cf9b837e94d970e13f4fad650bef4ef" title="Removes the factory associated with the given type. Returns false if that type did...">Entity::Loader::remove</a>(<span class="keyword">const</span> std::string&amp; type){
<a name="l00098"></a>00098         <span class="comment">//Find the Factory in the map for this type.</span>
<a name="l00099"></a>00099         Entity::TypeFactoryMap::iterator factoryItr = <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.find(type);
<a name="l00100"></a>00100         <span class="comment">//If the type isn't already in the map, return false</span>
<a name="l00101"></a>00101         <span class="keywordflow">if</span>(factoryItr == <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.end()){
<a name="l00102"></a>00102                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104         <span class="keyword">delete</span> factoryItr-&gt;second;
<a name="l00105"></a>00105         <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.erase(factoryItr);
<a name="l00106"></a>00106         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="class_entity_1_1_loader.html#b9756a289d5344fa846ee57a14f6cd2a">00109</a> <span class="keywordtype">void</span> <a class="code" href="class_entity_1_1_loader.html#b9756a289d5344fa846ee57a14f6cd2a" title="Removes all registered factories and frees up their memory.">Entity::Loader::removeAll</a>(){
<a name="l00110"></a>00110         Entity::TypeFactoryMap::iterator factoryItr;
<a name="l00111"></a>00111         Entity::TypeFactoryMap::iterator factoryItrEnd = <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.end();
<a name="l00112"></a>00112 
<a name="l00113"></a>00113         <span class="keywordflow">for</span>(factoryItr = <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.begin(); factoryItr != factoryItrEnd; ++factoryItr)
<a name="l00114"></a>00114         {
<a name="l00115"></a>00115                 <span class="keyword">delete</span> factoryItr-&gt;second;
<a name="l00116"></a>00116         }
<a name="l00117"></a>00117         <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.clear();
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="class_entity_1_1_loader.html#16daef119d065ec413dcfcb975537481">00120</a> <a class="code" href="class_entity_1_1_entity_factory.html" title="Base class for all factories in the system. Provides a loadEntity method given an...">Entity::EntityFactory</a>* <a class="code" href="class_entity_1_1_loader.html#16daef119d065ec413dcfcb975537481" title="Returns the factory pointer given a type name string. This should be used by EntityManager...">Entity::Loader::getFactory</a>(<span class="keyword">const</span> std::string&amp; type){
<a name="l00121"></a>00121         <span class="comment">//Find the Factory in the map for this type.</span>
<a name="l00122"></a>00122         Entity::TypeFactoryMap::iterator factoryItr = <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.find(type);
<a name="l00123"></a>00123         <span class="comment">//If the type isn't already in the map, insert and return true</span>
<a name="l00124"></a>00124         <span class="keywordflow">if</span>(factoryItr == <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.end()){
<a name="l00125"></a>00125                 <span class="keywordflow">return</span> NULL;
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127         <span class="keywordflow">return</span> factoryItr-&gt;second;
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="class_entity_1_1_loader.html#57f9d991256d8ad2ae0c509ca31e3864">00131</a> <a class="code" href="class_world_entity.html">WorldEntity</a>&amp; <a class="code" href="class_entity_1_1_loader.html#57f9d991256d8ad2ae0c509ca31e3864" title="Creates the worldEntity using the provided factory and returns a reference to it...">Entity::Loader::loadEntity</a>(<a class="code" href="class_entity_1_1_entity_info.html" title="EntityInfo is a data structure for storing the information about an entity loaded...">EntityInfo</a>* entityInfo){
<a name="l00132"></a>00132         std::cout &lt;&lt; <span class="stringliteral">"calling factory for "</span> &lt;&lt; entityInfo-&gt;<a class="code" href="class_entity_1_1_entity_info.html#f246a848c7b1c35a109f24b64b95e0df" title="The name of the Entity.">m_Name</a> &lt;&lt; <span class="stringliteral">" with xml file "</span> &lt;&lt; entityInfo-&gt;<a class="code" href="class_entity_1_1_entity_info.html#96c57ce423886b9d8c768a4b8e819ad9" title="The xml filename the factory will use to instantiate a worldentity.">m_XMLFile</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00133"></a>00133         std::cout.flush();
<a name="l00134"></a>00134         <span class="keywordflow">return</span> entityInfo-&gt;<a class="code" href="class_entity_1_1_entity_info.html#7c321247fa2959adc6ff3b89fb407c7b" title="The pointer to the factory for this entity, can be determined by type string.">mp_Factory</a>-&gt;<a class="code" href="class_entity_1_1_entity_factory.html#e1bacbc631488f64e142b62fc7f93514" title="Each child class of EntityFactory should implement the way it wishes to load its...">loadEntity</a>(entityInfo-&gt;<a class="code" href="class_entity_1_1_entity_info.html#96c57ce423886b9d8c768a4b8e819ad9" title="The xml filename the factory will use to instantiate a worldentity.">m_XMLFile</a>);
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="class_entity_1_1_loader.html#6c612adfb9a0fee09a03c975a3964229">00139</a> <span class="keywordtype">bool</span> <a class="code" href="class_entity_1_1_loader.html#6c612adfb9a0fee09a03c975a3964229" title="Registers a factory and type into the Loader. These are hard coded in the EntityManager...">Entity::Loader::registerFactory</a>(<span class="keyword">const</span> std::string&amp; type, <a class="code" href="class_entity_1_1_entity_factory.html" title="Base class for all factories in the system. Provides a loadEntity method given an...">EntityFactory</a>* factory){
<a name="l00140"></a>00140         <span class="comment">//Find the Factory in the map for this type.</span>
<a name="l00141"></a>00141         Entity::TypeFactoryMap::iterator factoryItr = <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.find(type);
<a name="l00142"></a>00142         <span class="comment">//If the type isn't already in the map, insert and return true</span>
<a name="l00143"></a>00143         <span class="keywordflow">if</span>(factoryItr == <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.end()){
<a name="l00144"></a>00144                 <a class="code" href="class_entity_1_1_loader.html#aea3f63c82177317be76837692e507f7">m_FactoryMap</a>.insert(make_pair(type, factory));
<a name="l00145"></a>00145                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147         <span class="comment">//Type was already associated with some factory</span>
<a name="l00148"></a>00148         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150         
<a name="l00151"></a><a class="code" href="class_entity_1_1_entity_info.html#ea858aa92c191bb7d5b325cd637893b9">00151</a> <span class="keywordtype">void</span> <a class="code" href="class_entity_1_1_entity_info.html#ea858aa92c191bb7d5b325cd637893b9" title="Releases any memory this entity is taking up so it can be dropped from the system...">Entity::EntityInfo::destroy</a>(){
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="class_entity_1_1_entity_info.html#ea348bb1e666a84b2bd4c260a7ab5ddd">00154</a> <a class="code" href="class_entity_1_1_entity_info.html#ea348bb1e666a84b2bd4c260a7ab5ddd">Entity::EntityInfo::EntityInfo</a>(<span class="keyword">const</span> std::string&amp; sName, <span class="keyword">const</span> std::string&amp; sXMLFile,  <a class="code" href="class_entity_1_1_entity_factory.html" title="Base class for all factories in the system. Provides a loadEntity method given an...">EntityFactory</a>* p_Factory) : <a class="code" href="class_entity_1_1_entity_info.html#f246a848c7b1c35a109f24b64b95e0df" title="The name of the Entity.">m_Name</a>(sName), <a class="code" href="class_entity_1_1_entity_info.html#96c57ce423886b9d8c768a4b8e819ad9" title="The xml filename the factory will use to instantiate a worldentity.">m_XMLFile</a>(sXMLFile), <a class="code" href="class_entity_1_1_entity_info.html#7c321247fa2959adc6ff3b89fb407c7b" title="The pointer to the factory for this entity, can be determined by type string.">mp_Factory</a>(p_Factory){
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="class_entity_1_1_entity_info.html#0ba549f7406f97de7ee599f6dfe1cc84">00159</a> <a class="code" href="class_entity_1_1_entity_info.html#0ba549f7406f97de7ee599f6dfe1cc84">Entity::EntityInfo::~EntityInfo</a>(){
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="class_entity_1_1_entity_info.html#829ec3a13f04201a7ca5d84443307e87">00162</a> <span class="keyword">const</span> std::string&amp; <a class="code" href="class_entity_1_1_entity_info.html#829ec3a13f04201a7ca5d84443307e87" title="Returns the name this entity is referred to by.">Entity::EntityInfo::getName</a>()<span class="keyword"> const</span>{
<a name="l00163"></a>00163         <span class="keywordflow">return</span> <a class="code" href="class_entity_1_1_entity_info.html#f246a848c7b1c35a109f24b64b95e0df" title="The name of the Entity.">m_Name</a>;
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="_entity_manager_8cpp.html#f2b8cf2a669fa9f03ea8177b882b7d60">00166</a> std::ostream&amp; <a class="code" href="class_entity_1_1_entity_info.html#399eba53160d2f9be47e5e2d19c360f3">operator &lt;&lt; </a>(std::ostream&amp; os, <span class="keyword">const</span> <a class="code" href="class_entity_1_1_entity_info.html" title="EntityInfo is a data structure for storing the information about an entity loaded...">Entity::EntityInfo</a>&amp; entity){
<a name="l00167"></a>00167         <span class="keywordflow">return</span> os &lt;&lt; entity.<a class="code" href="class_entity_1_1_entity_info.html#829ec3a13f04201a7ca5d84443307e87" title="Returns the name this entity is referred to by.">getName</a>();
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="keywordtype">int</span> <a class="code" href="class_entity_manager.html#f972b9aa1ffb131ed5214c6395ad68e6" title="Next available ID to assign to the next WorldEntity that is instantiatated.">EntityManager::next_ID</a> = 1;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="class_entity_manager.html#7555637657d090171be6ceee8451de0a">00174</a> <a class="code" href="class_entity_manager.html#7555637657d090171be6ceee8451de0a">EntityManager::EntityManager</a>(){
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="class_entity_manager.html#71a36c9fb8d579a1a1ec108e0fccf175">00178</a> <a class="code" href="class_entity_manager.html#71a36c9fb8d579a1a1ec108e0fccf175">EntityManager::~EntityManager</a>(){
<a name="l00179"></a>00179         this-&gt;<a class="code" href="class_entity_manager.html#38bbb81e997e7adf2f8ecbb183355a0d" title="shutdown any resources used by the EntityManager.">shutdown</a>();
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a><a class="code" href="class_entity_manager.html#1d1254a497aeaecddd512db6b76582cd">00182</a> <span class="keywordtype">bool</span> <a class="code" href="class_entity_manager.html#1d1254a497aeaecddd512db6b76582cd" title="Add new entity definitions. This function is the same as init in that it loads in...">EntityManager::addNewDefinitions</a>(<span class="keyword">const</span> std::string&amp; XMLEntityDefinition){
<a name="l00183"></a>00183         irr::io::IrrXMLReader* xml = irr::io::createIrrXMLReader(XMLEntityDefinition.c_str());
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         <span class="comment">// strings for storing the data we want to get out of the file</span>
<a name="l00186"></a>00186         std::string name;
<a name="l00187"></a>00187         std::string xmlFile;
<a name="l00188"></a>00188         std::string type;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         <span class="keywordflow">while</span>(xml &amp;&amp; xml-&gt;read())
<a name="l00191"></a>00191         {
<a name="l00192"></a>00192                 <span class="keywordflow">switch</span>(xml-&gt;getNodeType())
<a name="l00193"></a>00193                 {
<a name="l00194"></a>00194                 <span class="keywordflow">case</span> irr::io::EXN_TEXT:
<a name="l00195"></a>00195                         <span class="comment">//No text nodes</span>
<a name="l00196"></a>00196                         <span class="keywordflow">break</span>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198                 <span class="keywordflow">case</span> irr::io::EXN_ELEMENT:
<a name="l00199"></a>00199                         <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">"entity"</span>, xml-&gt;getNodeName())){
<a name="l00200"></a>00200                                 name = xml-&gt;getAttributeValue(<span class="stringliteral">"name"</span>);
<a name="l00201"></a>00201                                 xmlFile = xml-&gt;getAttributeValue(<span class="stringliteral">"file"</span>);
<a name="l00202"></a>00202                                 type= xml-&gt;getAttributeValue(<span class="stringliteral">"type"</span>);
<a name="l00203"></a>00203                         }
<a name="l00204"></a>00204                         <span class="keywordflow">break</span>;
<a name="l00205"></a>00205                 }
<a name="l00206"></a>00206                 <a class="code" href="class_entity_1_1_entity_factory.html" title="Base class for all factories in the system. Provides a loadEntity method given an...">Entity::EntityFactory</a>* factory = <a class="code" href="class_entity_manager.html#65f5e8c10d8438729ea82f885a76c749">m_Loader</a>.<a class="code" href="class_entity_1_1_loader.html#16daef119d065ec413dcfcb975537481" title="Returns the factory pointer given a type name string. This should be used by EntityManager...">getFactory</a>(type);
<a name="l00207"></a>00207                 <span class="keywordflow">if</span> (factory){
<a name="l00208"></a>00208                         <a class="code" href="class_entity_1_1_entity_info.html" title="EntityInfo is a data structure for storing the information about an entity loaded...">Entity::EntityInfo</a>* entityInfo = <span class="keyword">new</span> <a class="code" href="class_entity_1_1_entity_info.html" title="EntityInfo is a data structure for storing the information about an entity loaded...">Entity::EntityInfo</a>(name, xmlFile, factory);
<a name="l00209"></a>00209                                 <span class="keywordflow">if</span> ((<a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.insert(make_pair(name, entityInfo))).second){
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                                 }
<a name="l00212"></a>00212                                 <span class="keywordflow">else</span>{
<a name="l00213"></a>00213                                         <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.clear();
<a name="l00214"></a>00214                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00215"></a>00215                                 }
<a name="l00216"></a>00216                 }
<a name="l00217"></a>00217                 <span class="keywordflow">else</span>{
<a name="l00218"></a>00218                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221         <span class="keyword">delete</span> xml;
<a name="l00222"></a>00222         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a><a class="code" href="class_entity_manager.html#52ecdb78de6f3ac7ec75629df546e90f">00225</a> <span class="keywordtype">bool</span> <a class="code" href="class_entity_manager.html#52ecdb78de6f3ac7ec75629df546e90f" title="Initialize the Entity system. Provide the filename of the XML file that has the global...">EntityManager::init</a>(<span class="keyword">const</span> std::string&amp; XMLEntityDefinition){
<a name="l00226"></a>00226         std::cout &lt;&lt; <span class="stringliteral">"loading xml file with name "</span> &lt;&lt; XMLEntityDefinition &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00227"></a>00227         <span class="comment">//Should register all the factories to each type here!!!!</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229         this-&gt;<a class="code" href="class_entity_manager.html#65f5e8c10d8438729ea82f885a76c749">m_Loader</a>.<a class="code" href="class_entity_1_1_loader.html#6c612adfb9a0fee09a03c975a3964229" title="Registers a factory and type into the Loader. These are hard coded in the EntityManager...">registerFactory</a>(<span class="stringliteral">"ball"</span>, <span class="keyword">new</span> <a class="code" href="class_entity_1_1_ball_factory.html">Entity::BallFactory</a>());
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         irr::io::IrrXMLReader* xml = irr::io::createIrrXMLReader(XMLEntityDefinition.c_str());
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         <span class="keywordflow">if</span> (!xml){
<a name="l00234"></a>00234                 std::cout &lt;&lt; <span class="stringliteral">"There was an error loading the xml file "</span> &lt;&lt; XMLEntityDefinition &lt;&lt; <span class="stringliteral">".\n"</span>;
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236         <span class="comment">// strings for storing the data we want to get out of the file</span>
<a name="l00237"></a>00237         std::string name;
<a name="l00238"></a>00238         std::string xmlFile;
<a name="l00239"></a>00239         std::string type;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="keywordflow">while</span>(xml &amp;&amp; xml-&gt;read())
<a name="l00242"></a>00242         {
<a name="l00243"></a>00243                 <span class="keywordflow">switch</span>(xml-&gt;getNodeType())
<a name="l00244"></a>00244                 {
<a name="l00245"></a>00245                 <span class="keywordflow">case</span> irr::io::EXN_TEXT:
<a name="l00246"></a>00246                         <span class="comment">//No text nodes</span>
<a name="l00247"></a>00247                         <span class="keywordflow">break</span>;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                 <span class="keywordflow">case</span> irr::io::EXN_ELEMENT:
<a name="l00250"></a>00250                         <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">"entity"</span>, xml-&gt;getNodeName())){
<a name="l00251"></a>00251                                 <a class="code" href="class_entity_1_1_entity_factory.html" title="Base class for all factories in the system. Provides a loadEntity method given an...">Entity::EntityFactory</a>* factory = <a class="code" href="class_entity_manager.html#65f5e8c10d8438729ea82f885a76c749">m_Loader</a>.<a class="code" href="class_entity_1_1_loader.html#16daef119d065ec413dcfcb975537481" title="Returns the factory pointer given a type name string. This should be used by EntityManager...">getFactory</a>(xml-&gt;getAttributeValue(<span class="stringliteral">"type"</span>));
<a name="l00252"></a>00252                                 <span class="keywordflow">if</span> (factory){
<a name="l00253"></a>00253                                         <a class="code" href="class_entity_1_1_entity_info.html" title="EntityInfo is a data structure for storing the information about an entity loaded...">Entity::EntityInfo</a>* entityInfo = <span class="keyword">new</span> <a class="code" href="class_entity_1_1_entity_info.html" title="EntityInfo is a data structure for storing the information about an entity loaded...">Entity::EntityInfo</a>(xml-&gt;getAttributeValue(<span class="stringliteral">"name"</span>), xml-&gt;getAttributeValue(<span class="stringliteral">"file"</span>), factory);
<a name="l00254"></a>00254                                         <span class="keywordflow">if</span> ((<a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.insert(make_pair(std::string(xml-&gt;getAttributeValue(<span class="stringliteral">"name"</span>)), entityInfo))).second){
<a name="l00255"></a>00255                                                 std::cout &lt;&lt; <span class="stringliteral">"added entity with name "</span> &lt;&lt; std::string(xml-&gt;getAttributeValue(<span class="stringliteral">"name"</span>)) &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257                                                 }
<a name="l00258"></a>00258                                                 <span class="keywordflow">else</span>{
<a name="l00259"></a>00259                                                         <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.clear();
<a name="l00260"></a>00260                                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00261"></a>00261                                                 }
<a name="l00262"></a>00262                                 }
<a name="l00263"></a>00263                                 <span class="keywordflow">else</span>{
<a name="l00264"></a>00264                                         <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.clear();
<a name="l00265"></a>00265                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00266"></a>00266                                 }
<a name="l00267"></a>00267                                         }
<a name="l00268"></a>00268                                         <span class="keywordflow">break</span>;
<a name="l00269"></a>00269                                 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         <span class="keyword">delete</span> xml;
<a name="l00273"></a>00273         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a><a class="code" href="class_entity_manager.html#38bbb81e997e7adf2f8ecbb183355a0d">00276</a> <span class="keywordtype">void</span> <a class="code" href="class_entity_manager.html#38bbb81e997e7adf2f8ecbb183355a0d" title="shutdown any resources used by the EntityManager.">EntityManager::shutdown</a>(){
<a name="l00277"></a>00277         <span class="comment">//Remove all instantiated entities</span>
<a name="l00278"></a>00278         <a class="code" href="class_entity_manager.html#1acff1aa6c224e4755cf67a3163c4677" title="Deletes all currently instantiated entities. This would be ideal for moving from...">removeAll</a>();
<a name="l00279"></a>00279         <span class="comment">//Remove all EntityInfo</span>
<a name="l00280"></a>00280         Entity::StrEntityMap::iterator entityItrEnd = <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.end();
<a name="l00281"></a>00281         Entity::StrEntityMap::iterator entityItr;
<a name="l00282"></a>00282         <span class="keywordflow">for</span>(entityItr = <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.begin(); entityItr != entityItrEnd; ++entityItr)
<a name="l00283"></a>00283         {
<a name="l00284"></a>00284                 entityItr-&gt;second-&gt;destroy();
<a name="l00285"></a>00285                 <span class="keyword">delete</span> entityItr-&gt;second;
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <span class="comment">//Remove everything inside the loader</span>
<a name="l00289"></a>00289         <a class="code" href="class_entity_manager.html#65f5e8c10d8438729ea82f885a76c749">m_Loader</a>.<a class="code" href="class_entity_1_1_loader.html#b9756a289d5344fa846ee57a14f6cd2a" title="Removes all registered factories and frees up their memory.">removeAll</a>();
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.clear();
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a><a class="code" href="class_entity_manager.html#a6f5279851fc4362a9baed5b4d6a1e9f">00294</a> <a class="code" href="class_world_entity.html">WorldEntity</a>&amp; <a class="code" href="class_entity_manager.html#a6f5279851fc4362a9baed5b4d6a1e9f" title="Retrieves the entity information for an entity named by the given string. Loads this...">EntityManager::createEntity</a>(<span class="keyword">const</span> std::string name){
<a name="l00295"></a>00295         <span class="comment">//Find the Entity in the Str EntityInfo map for this entity name.</span>
<a name="l00296"></a>00296         std::cout &lt;&lt; <span class="stringliteral">"finding entity with name "</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00297"></a>00297         Entity::StrEntityMap::iterator entityItr = <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.find(name);
<a name="l00298"></a>00298         <span class="comment">//If the Entity wasn't found, return false</span>
<a name="l00299"></a>00299         <span class="keywordflow">if</span>(entityItr == <a class="code" href="class_entity_manager.html#e6094224a3288644d93f44948724fc26" title="Maps strings to Entity objects.">m_EntityMap</a>.end()){
<a name="l00300"></a>00300                 std::cout &lt;&lt; <span class="stringliteral">"entity not found. throwing exception!\n"</span>;
<a name="l00301"></a>00301                 <span class="keywordflow">throw</span> <a class="code" href="class_entity_1_1_entity_creation_failed.html">Entity::EntityCreationFailed</a>();
<a name="l00302"></a>00302         }
<a name="l00303"></a>00303         <span class="keywordflow">return</span>(<a class="code" href="class_entity_manager.html#65f5e8c10d8438729ea82f885a76c749">m_Loader</a>.<a class="code" href="class_entity_1_1_loader.html#57f9d991256d8ad2ae0c509ca31e3864" title="Creates the worldEntity using the provided factory and returns a reference to it...">loadEntity</a>(entityItr-&gt;second));
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="class_entity_manager.html#bc7a55948564fb190856c154a1991dc1">00306</a> <span class="keywordtype">bool</span> <a class="code" href="class_entity_manager.html#bc7a55948564fb190856c154a1991dc1" title="Deletes an entity identified by the given ID number. This can be called to delete...">EntityManager::remove</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> entityID){
<a name="l00307"></a>00307         <span class="comment">//Find the Entity in the ID map for this entityID.</span>
<a name="l00308"></a>00308         <a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a> = <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.find(entityID);
<a name="l00309"></a>00309         <span class="comment">//If the Entity wasn't found, return false</span>
<a name="l00310"></a>00310         <span class="keywordflow">if</span>(<a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a> == <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.end())
<a name="l00311"></a>00311                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="keyword">delete</span> <a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a>-&gt;second;
<a name="l00314"></a>00314         <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.erase(<a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a>);
<a name="l00315"></a>00315         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="class_entity_manager.html#1acff1aa6c224e4755cf67a3163c4677">00318</a> <span class="keywordtype">void</span> <a class="code" href="class_entity_manager.html#1acff1aa6c224e4755cf67a3163c4677" title="Deletes all currently instantiated entities. This would be ideal for moving from...">EntityManager::removeAll</a>(){
<a name="l00319"></a>00319         Entity::IdEntityMap::iterator entityItrEnd = <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.end();
<a name="l00320"></a>00320         <span class="keywordflow">for</span>(<a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a> = <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.begin(); <a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a> != entityItrEnd; ++<a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a>)
<a name="l00321"></a>00321         {
<a name="l00322"></a>00322                 <span class="keyword">delete</span> <a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a>-&gt;second;
<a name="l00323"></a>00323         }
<a name="l00324"></a>00324         <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.clear();
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a><a class="code" href="class_entity_manager.html#9a9d41e3827f73062a2d5d5f7e7beafa">00327</a> <a class="code" href="class_world_entity.html">WorldEntity</a>&amp; <a class="code" href="class_entity_manager.html#9a9d41e3827f73062a2d5d5f7e7beafa" title="Returns a reference to an already instantiated WorldEntity object given it&amp;#39;s...">EntityManager::getEntity</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> entityID){
<a name="l00328"></a>00328         <span class="comment">//Find the entity in the ID map for this entityID</span>
<a name="l00329"></a>00329         <a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a> = <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.find(entityID);
<a name="l00330"></a>00330         <span class="comment">//If the Entity wasn't found, return NULL</span>
<a name="l00331"></a>00331         <span class="keywordflow">if</span> (<a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a> == <a class="code" href="class_entity_manager.html#02684740d7947cc2782cba738bfe8cff" title="Maps integers to instantiated world entities.">m_IdEntityMap</a>.end())
<a name="l00332"></a>00332                 <span class="keywordflow">throw</span> <a class="code" href="class_entity_1_1_entity_doesnt_exist.html">Entity::EntityDoesntExist</a>();
<a name="l00333"></a>00333         <span class="keywordflow">return</span> *(<a class="code" href="class_entity_manager.html#e402f5c0e56f7c09b8b17ed8750b1081" title="An iterator for the id entity map.">m_EntityItr</a>-&gt;second);
<a name="l00334"></a>00334 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Mar 7 13:12:58 2008 for Bouncibility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
